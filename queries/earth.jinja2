{% if zoom < 9 %}

SELECT
    '' AS name,
    sum(way_area)::bigint AS area,
    mz_calculate_output_earth(t.*) AS mz_properties,
    'naturalearthdata.com' AS source,
    {% filter geometry %}st_union(the_geom){% endfilter %} AS __geometry__,
    max(gid) AS __id__,
    NULL AS label_placement,
    NULL AS boundary
FROM
{% if zoom < 2 %}
    ne_110m_land
{% elif 2 <= zoom < 5 %}
    ne_50m_land
{% elif 5 <= zoom < 9 %}
    ne_10m_land
{% endif %}

WHERE
    mz_earth_min_zoom <= {{ zoom }} AND
    {{ bounds|bbox_filter('the_geom') }}
GROUP BY mz_properties

{% elif 9 <= zoom %}

SELECT
    '' AS name,
    way_area::bigint AS area,
    mz_calculate_output_earth(t.*) AS mz_properties,
    'openstreetmapdata.com' AS source,
    {% filter geometry %}st_union(the_geom){% endfilter %} AS __geometry__,
    max(gid) AS __id__
    NULL AS label_placement,
    NULL AS tags

FROM
    land_polygons

WHERE
    {{ bounds|bbox_filter('the_geom') }}

UNION ALL

SELECT
    name,
    way_area::bigint AS area,
    mz_calculate_output_earth(t.*) AS mz_properties,
    'openstreetmap.org' AS source,
    {% filter geometry %}way{% endfilter %} AS __geometry__,
    osm_id AS __id__,
    NULL AS label_placement,
    %#tags AS tags

FROM planet_osm_polygon t

WHERE
    mz_earth_min_zoom <= {{ zoom }} AND
    {{ bounds|bbox_filter('way') }}

UNION ALL

SELECT
    name,
    NULL AS area,
    mz_calculate_output_earth(t.*) AS mz_properties,
    'openstreetmap.org' AS source,
    {% filter geometry %}way{% endfilter %} AS __geometry__,
    osm_id AS __id__,
    NULL AS label_placement,
    %#tags AS tags

FROM planet_osm_line t

WHERE
    mz_earth_min_zoom <= {{ zoom }} AND
    {{ bounds|bbox_filter('way') }}

{% endif %}

UNION ALL

SELECT
  name,
  mz_calculate_output_earth(t.*) AS mz_properties,
  'openstreetmap.org' AS source,
  way AS __geometry__,
  osm_id AS __id__,
  'yes' AS label_placement,
  %#tags AS tags

FROM
  planet_osm_point t

WHERE
  mz_earth_min_zoom <= {{ zoom }} AND
  {{ bounds|bbox_filter('way') }}